# 添付ファイルについて

# 概要
システムにアップロードできるファイルについての資料です。

## 添付ファイル種別
- 添付ファイルには2種類ある
- 添付ファイル(申出者)
  - 申出者がアップロードした添付ファイル。主に申出に必要な書類をアップロードしたもの
- 添付ファイル(事務局)
  - 事務局側からアップロードした添付ファイル。申出内容に対する添削など、事務局から申出者に対してファイルを送付したもの
  - 「事務局送付資料」と画面上では表記している
  - R5追加開発にて実装

# 詳細
## 添付ファイル(申出者)
- 添付ファイルの全種別は以下を参照。
[https://github.com/git-balocco/ncc01/blob/main/packages/Apply/Enterprise/Classification/AttachmentTypes.php](https://github.com/git-balocco/ncc01/blob/main/packages/Apply/Enterprise/Classification/AttachmentTypes.php) 

- ファイルの添付方法
  - 申出詳細画面からアップロード
  - 添付ファイル画面からアップロード
    - attachment.attachment_type_idはnullで登録される

## 添付ファイル(事務局)
- ファイルの添付方法
  - 事務局送付資料画面からアップロード
    - 事務局/管理者権限のユーザー(users.role=1、2)のみ事務局送付資料画面を閲覧可能

## 添付ファイルステータス
attachment.statusによる添付ファイルのステータスは3種類
- アップロード(status=1)：ファイルをアップロードした状態
- 提出済(status=2)：申出者がファイルを事務局に提出した状態
- 承認済(status=2)：提出されたファイルを、事務局が承認した状態

- 物理削除のためファイル削除ステータスはなし
- 以前は有効/無効フラグ(is_active)を使用していたが、R5追加開発で使用されなくなった

## 添付ファイルステータス遷移図
wiki資料参照  
https://wiki.balocco.info/%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%83%85%E5%A0%B1/%E3%81%8C%E3%82%93%E3%82%BB%E3%83%B3%E3%82%BF%E3%83%BC%E9%9B%BB%E5%AD%90%E7%94%B3%E8%AB%8B%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E6%A1%88%E4%BB%B6/%E6%A3%9A%E3%81%AE%E6%95%B4%E7%90%86%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E3%81%AE%E3%83%A1%E3%83%A2#%E6%A3%9A%E3%81%AE%E6%95%B4%E7%90%86%E3%81%AB%E3%81%A6%E8%A1%8C%E3%81%86%E6%B7%BB%E4%BB%98%E8%B3%87%E6%96%99%E3%81%AE%E7%8A%B6%E6%85%8B

## PDF出力
- PDF出力時、添付ファイルステータスが「提出済」、「承認済」の場合、PDF出力時にチェックする
- R5追加開発以前は有効(is_active=true)ファイルのみPDF出力時にチェックされていた仕様を変更

